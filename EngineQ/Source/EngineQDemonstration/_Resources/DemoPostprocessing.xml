<?xml version="1.0" encoding="utf-8" ?>
<RenderingUnitConfiguration>
	<Textures>
		<!-- G-Buffer -->
		<TextureConfiguration Name="Position" DataType="GL_FLOAT" InternalFormat="GL_RGB16F" Format="GL_RGB" />
		<TextureConfiguration Name="Normal" DataType="GL_FLOAT" InternalFormat="GL_RGB16F" Format="GL_RGB" />
		<TextureConfiguration Name="Albedo" DataType="GL_FLOAT" InternalFormat="GL_RGBA16F" Format="GL_RGBA" />

		<!-- Bloom -->
		<TextureConfiguration Name="Scene" DataType="GL_FLOAT" InternalFormat="GL_RGBA16F" Format="GL_RGBA" />
		<TextureConfiguration Name="Bloom1" DataType="GL_FLOAT" InternalFormat="GL_RGBA16F" Format="GL_RGBA" />
		<TextureConfiguration Name="Bloom2" DataType="GL_FLOAT" InternalFormat="GL_RGBA16F" Format="GL_RGBA" />
		<!--TextureConfiguration Name="SSAO" DataType="GL_FLOAT" InternalFormat="GL_RGB" Format="GL_RED" /-->
		<TextureConfiguration Name="SSAO" DataType="GL_FLOAT" InternalFormat="GL_R16F" Format="GL_RED" />
		<TextureConfiguration Name="SSAOBlur"  DataType="GL_FLOAT"  InternalFormat="GL_R16F" Format="GL_RED" />
	</Textures>
	
	<Renderer Deferred="true" GlobalShadows="true">
		<Output>
			<OutputTexture Texture="Position"/>
			<OutputTexture Texture="Normal" />
			<OutputTexture Texture="Albedo" />
		</Output>
	</Renderer>
	
	<Effects>

		<!-- SSAO -->
		<EffectConfiguration Shader="SSAO">
			<Controller Assembly="QScripts" Namespace="QScripts" Class="SSAOController" />
			<Input>
				<InputPair Texture="Position" LocationName="gPosition" />
				<InputPair Texture="Normal" LocationName="gNormal" />
			</Input>
			<Output>
				<OutputTexture Texture="SSAO" />
			</Output>
		</EffectConfiguration>

		<!-- SSAO Blur -->
		<EffectConfiguration Shader="SSAOBlur">
			<Input>
				<InputPair Texture="SSAO" />
			</Input>
			<Output>
				<OutputTexture Texture="SSAOBlur" />
			</Output>
		</EffectConfiguration>
		

		<!-- Deferred lighting -->
		<EffectConfiguration Shader="DeferredLightingShadows" ApplyShadowsData="true" >
			<Input>
				<InputPair Texture="Position" LocationName="gPosition" />
				<InputPair Texture="Normal" LocationName="gNormal" />
				<InputPair Texture="Albedo" LocationName="gColorSpecular" />
				<InputPair Texture="SSAOBlur" LocationName="ssaoTexture" />
			</Input>
			<Output>
				<OutputTexture Texture="Scene" />
			</Output>
		</EffectConfiguration>


		<!-- Extract bright colors -->
		<EffectConfiguration Shader="BloomExtraction">
			<Controller Assembly="QScripts" Namespace="QScripts" Class="MyEffectController" />

			<Input>
				<InputPair Texture="Scene" />
			</Input>
			<Output>
				<OutputTexture Texture="Bloom2" />
			</Output>
		</EffectConfiguration>


		<!-- Bloom blur passes -->
		<EffectRepeat Iterations="10">

			<!-- Bloom vertical blur -->
			<EffectConfiguration Shader="BloomVerticalBlur">
				<Input>
					<InputPair Texture="Bloom2" />
				</Input>
				<Output>
					<OutputTexture Texture="Bloom1" />
				</Output>
			</EffectConfiguration>

			<!-- Bloom horizontal blur -->
			<EffectConfiguration Shader="BloomHorizontalBlur">
				<Input>
					<InputPair Texture="Bloom1" />
				</Input>
				<Output>
					<OutputTexture Texture="Bloom2" />
				</Output>
			</EffectConfiguration>

		</EffectRepeat>


		<!-- Combine Bloom and Scene -->
		<EffectConfiguration Shader="Combine">
			<Input>
				<InputPair Texture="Scene" LocationName="scene" />
				<InputPair Texture="Bloom2" LocationName="bloom" />
			</Input>
			<Output>
				<OutputTexture Texture="Screen" />
			</Output>
		</EffectConfiguration>




		<!--<EffectConfiguration Shader="Debug/ShadowmapDrawer" ApplyShadowsData="true">
			<Controller Assembly="QScripts" Namespace="QScripts" Class="ShadowmapDrawerController" />
			<Output>
				<OutputTexture Texture="Screen"></OutputTexture>
			</Output>
		</EffectConfiguration>-->
	
	</Effects>


	<NotUsed>


		


	</NotUsed>

</RenderingUnitConfiguration>